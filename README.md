# 《操作系统课程设计》实验代码

## 实验

### 进程调度模拟

[进程调度模拟代码](/src/main/kotlin/E01Processing.kt)

通过实习模拟在单处理器环境下的处理器调度，加深了解处理器调度的工作。
本实验设计一个按优先数调度算法实现处理器调度的程序，该程序模拟CPU对于进程的调度，进程使用PCB控制，处理器可以添加进程、运行进程、阻塞进程、唤醒进程。在该模拟程序中，进程拥有运行时间来确定执行时间、优先级来决定进程运行顺序。
具体要求：

1. 假定系统有n个进程，每个进程用一个PCB来代表。PCB的结构为：
    - 进程名——如P1~Pn。
    - 指针——按优先数的大小把n个进程连成队列，用指针指出下一个进程PCB的首地址。
    - 要求运行时间——假设进程需要运行的单位时间数。
    - 优先数——赋予进程的优先数，调度时总是选取优先数大的进程先执行。
    - 状态——假设两种状态：就绪和结束，用R表示就绪，用E表示结束。初始状态都为就绪状态。
2. 开始运行之前，为每个进程确定它的“优先数”和“要求运行时间”。通过键盘输入这些参数读入这些参数。
3. 处理器总是选择优先级最高的进程运行，优先级最高的进程或者在队首，或者通过算法从就绪队列中选出优先级最高的进程。采用动态改变优先数的办法，进程每调度运行1次，优先数减1，要求运行时间减1。
4. 进程运行一次后，若要求运行时间不等于0，则将它加入就绪队列，否则，将状态改为“结束”，退出就绪队列。
5. 若就绪队列为空，结束，否则转到(3)重复。

要求能从键盘接收输入的进程优先数及要求运行时间，能显示每次进程调度的情况，如哪个进程在运行，哪些进程就绪，就绪进程的排列情况。

### 内存分配模拟

[内存分配模拟代码](/src/main/kotlin/E02Memory.kt)

在分页管理方式下采用位示图来表示主存分配情况，实现主存分配和回收

要求:
1. 假定系统的主存被分成大小相等的64个块，用0/1对应空闲/占用。
2. 当要装入一个作业时，根据作业对主存的需求量，先查空闲块数是否能满足作业要求，若能满足，则查位示图，修改位示图和空闲块数。位置与块号的对应关系为： 
    - 块号=j*8+i，其中i表示位，j表示字节。
    - 根据分配的块号建立页表。页表包括两项：页号和块号。
3. 回收时，修改位示图和空闲块数。

要求能接受来自键盘的空间申请及释放请求，能显示位示图和空闲块数的变化，能显示进程的页表。

### 磁盘分配模拟

[磁盘分配模拟代码](/src/main/kotlin/E03Disk.kt)

连续磁盘存储空间的分配和回收实验要求：
1. 要在磁盘上建立顺序文件时，必须把按序排列的逻辑记录依次存放在磁盘的连续存储空间中。可假定磁盘初始化时，已把磁盘存储空间划分成若干等长的块（扇区），按柱面号和盘面号的顺序给每一块确定一个编号。随着文件的建立、删除、磁盘存储空间被分成许多区（每一区包含若干块），有的区存放着文件，而有的区是空闲的。当要建立顺序文件时必须找到一个合适的空闲区来存放文件记录，当一个文件被删除时，则该文件占用的区应成为空闲区。为此可用一张空闲区表来记录磁盘存储空间中尚未占用的部分，格式如下：

    |序号|起始空闲块号|空闲块个数|状态  |
    |---|----------|---------|-----|
    |1  |5         |6        |未分配|
    |2  |14        |3        |未分配|
    |3  |21        |30       |未分配|
    |...|...       |...      |...  |

2. 建立文件时，先查找空闲区表，从空闲区表中找出一个块数能满足要求的区，由起始空闲块号能依次推得可使用的其它块号。若不需要占用该区的所有块时，则剩余的块仍应为未分配的空闲块，这时要修改起始空闲块号和空闲块数。若占用了该区的所有块，则删去该空闲区。删除一个文件时，需要考虑空闲块的合并情况。
3. 当找到空闲块后，必须启动磁盘把信息存放到指定的块中，启动磁盘必须给出由三个参数组成的物理地址：盘面号、柱面号和物理记录号（即扇区号）。故必须把找到的空闲块号换算成磁盘的物理地址。
   
   为了减少移臂次数，磁盘上的信息按柱面上各磁道顺序存放。现假定一个盘组共有200个柱面，（编号0-199）每个柱面有20个磁道（编号0-19，同一柱面上的各磁道分布在各盘面上，故磁道号即盘面号。），每个磁道被分成等长的6个物理记录（编号0-5，每个盘面被分成若干个扇区，故每个磁道上的物理记录号即为对应的扇区号）。那么，空闲块号与磁盘物理地址的对应关系如下：
    - 物理记录号 = 空闲块号 % 6
    - 磁道号=（空闲块号 / 6 ）% 20
    - 柱面号=（空闲块号 / 6）/20

4. 删除一个文件时，从文件目录表中可得到该文件在磁盘上的起始地址和逻辑记录个数，假定每个逻辑记录占磁盘上的一块，则可推算出归还后的起始空闲块号和块数，登记到空闲区表中。换算关系如下： 
    - 起始空闲块号=（柱面号*20+磁道号）*6+物理记录号
    - 空闲块数=逻辑记录数

要求把分配到的空闲块转换成磁盘物理地址，把归还的磁盘空间转换成空闲块号。
要求能接受来自键盘或文件的空间申请及释放请求，能显示或打印分配及回收后的空闲区表以及分配到的磁盘空间的起始物理地址：包括柱面号、磁道号、物理记录号（扇区号）。


### 调用系统调用fork创建子进程

[调用系统调用fork创建子进程代码](/inLinux/E04Fork.cpp)

利用fork()系统调用创建进程。

了解进程的创建过程，进一步理解进程的概念，明确进程和程序的区别。

编制一段程序，使用系统调用fork( )创建两个子进程，这样在此程序运行时，在系统中就有一个父进程和两个子进程在活动。每一个进程在屏幕上显示一个字符，其中父进程显示字符A，子进程分别显示字符 B和字符C。试观察、记录并分析屏幕上进程调度的情况。

### 进程同步模拟

...